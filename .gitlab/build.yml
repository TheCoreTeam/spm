---
.build_script_template: &build_script
  stage: build
  tags: ["docker", "large"]
  artifacts:
    name: spm_build_${VERSION}
    expire_in: 180 minutes
    untracked: true
    paths:
      - install-${VERSION}
      - build
      - spm-build-${VERSION}.log
  script:
    - .gitlab/build_linux.sh

.build_script_template_seq: &build_script_seq
  extends:
    - .build_script_template
    - .only-branches-seq

.build_script_template_mpi: &build_script_mpi
  extends:
    - .build_script_template
    - .only-branches-mpi

build_spm_seq:
  <<: *build_script_seq
  variables:
    VERSION: seq

build_spm_mpi:
  <<: *build_script_mpi
  variables:
    VERSION: mpi

build_spm_macosx:
  stage: build
  tags: ['macosx']
  variables:
    VERSION: macosx
  extends:
    - .only-branches-seq
  script:
    - .gitlab/build_macosx.sh
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"
    expire_in: 2 days
    untracked: true
    when: always
