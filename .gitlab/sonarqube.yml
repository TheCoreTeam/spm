---
sonarqube:
  stage: analyze
  tags: ["docker", "large"]
  extends: .only-master-mr
  when: manual
  needs: [build_spm_seq,build_spm_mpi,
          test_spm_seq_shm,test_spm_mpi_shm,test_spm_mpi_dist,
          test_wrapper_seq,test_wrapper_mpi,
          coverage]
  script:
    - ./tools/analysis.sh
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"
    expire_in: 180 minutes
    paths:
      - filelist.txt
      - spm-cppcheck.xml
      - spm-rats.xml
      - sonar-project.properties
      - sonar.log
    when: always
