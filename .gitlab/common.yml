#
# This file describes the common rules for the stages
#
---
# push event: executed only if the source branch name is master or starts with ci-
# schedule event: not executed
.only-master:
  interruptible: true
  rules:
    - if: ($CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH || $CI_COMMIT_BRANCH =~ /^ci-.*$/) && $CI_PIPELINE_SOURCE != "schedule"
  variables:
    BRANCH: master

# push event: executed only if the source branch name is master or starts with ci-
# merge request event: executed if the source branch name does not start with notest-
# schedule event: not executed
.only-master-mr:
  interruptible: true
  rules:
    - if: ($CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH || $CI_COMMIT_BRANCH =~ /^ci-.*$/) && $CI_PIPELINE_SOURCE != "schedule"
    - if: ($CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME !~ /^notest-.*$/)
  variables:
    BRANCH: branch

# merge request event: executed if the source branch name does not start with notest-
.only-mr:
  interruptible: true
  rules:
    - if: ($CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME !~ /^notest-.*$/)
  variables:
    BRANCH: branch

preliminary_checks:
  stage: .pre
  extends: .only-mr
  script:
    - .gitlab/check_ci.sh
